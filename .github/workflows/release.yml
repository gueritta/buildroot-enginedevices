name: Release

on:
  push:
    tags:
      - 'v*'

jobs:
  package:
    name: Package External Tree
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Create source tarball
        run: |
          # Package the external tree into a tarball
          # We exclude the .git and .github directories to keep it clean
          PROJECT_NAME="br-external-mixxx"
          VERSION="${{ github.ref_name }}"
          tar -czf "${PROJECT_NAME}-${VERSION}.tar.gz" \
            --transform "s|^\.|$PROJECT_NAME-$VERSION|" \
            --exclude-vcs \
            --exclude=.github \
            .

      - name: Create Release
        uses: softprops/action-gh-release@v2
        with:
          files: br-external-mixxx-${{ github.ref_name }}.tar.gz
          generate_release_notes: true

  # Example of a Build Job for Firmware Images
  # To enable this, uncomment the section below.
  # Note: A full Buildroot build can take several hours on GitHub Actions.
  #
  # build:
  #   name: Build Firmware Image
  #   runs-on: ubuntu-latest
  #   steps:
  #     - name: Checkout code
  #       uses: actions/checkout@v4
  #       with:
  #         path: mixxx-external
  #
  #     - name: Checkout Buildroot
  #       uses: actions/checkout@v4
  #       with:
  #         repository: buildroot/buildroot
  #         ref: 2023.02.x  # Recommended stable version
  #         path: buildroot
  #
  #     - name: Install Build Dependencies
  #       run: |
  #         sudo apt-get update
  #         sudo apt-get install -y build-essential grep sed diffutils \
  #           bash patch gzip bzip2 perl tar cpio unzip rsync \
  #           file bc wget python3
  #
  #     - name: Build jc11
  #       run: |
  #         cd buildroot
  #         make BR2_EXTERNAL=../mixxx-external jc11_defconfig
  #         make
  #
  #     - name: Upload Image
  #       uses: softprops/action-gh-release@v2
  #       with:
  #         files: buildroot/output/images/sdcard.img
